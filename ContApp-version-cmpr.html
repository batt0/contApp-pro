<!DOCTYPE html>

<html lang="es">

<head>

    <meta charset="UTF-8" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>ContaApp - Aplicación de Contabilidad</title>

    <!-- 1. Cargar Tailwind CSS -->

    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 2. Cargar librerías de React (versiones de producción optimizadas) -->

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>

    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- 3. Cargar Babel para compilar JSX -->

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- 4. Cargar librerías para generar PDF -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

</head>

<body class="bg-gray-100">

    <div id="root"></div>

    <div id="pdf-container" style="position:absolute;left:-9999px;top:-9999px;width:210mm"></div>

    <!-- 5. Código React minificado y ofuscado -->

    <script type="text/babel">

const{useState:uS,useEffect:uE,useRef:uR,useMemo:uM,useCallback:uC}=React;function usePersistentState(k,iV){const[sV,sSV]=uS(iV);const sVFN=v=>{const vTS=v instanceof Function?v(sV):v;sSV(vTS);};return[sV,sVFN]}const I={dashboard:<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" /></svg>,articles:<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" /></svg>,customers:<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>,invoices:<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,quotes:<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" /></svg>,accounting:<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,company:<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>,add:<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clipRule="evenodd" /></svg>,trash:<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" /></svg>,print:<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M5 4v3H4a2 2 0 00-2 2v6a2 2 0 002 2h12a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z" clipRule="evenodd" /></svg>,edit:<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" /><path fillRule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clipRule="evenodd" /></svg>,convert:<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>,pdf:<svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>};function C_Modal({children:c,onClose:o,title:t}){return(<div className="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 p-4 animate-fade-in"><div className="bg-white p-6 rounded-lg shadow-xl relative w-full max-w-lg animate-slide-up"><div className="flex justify-between items-center mb-4"><h3 className="text-xl font-bold text-gray-800">{t}</h3><button onClick={o} className="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button></div>{c}</div></div>)}function C_Notify({message:m,onConfirm:oC,onCancel:onC,type:t='alert'}){if(!m)return null;return(<div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-[100] p-4"><div className="bg-white p-7 rounded-lg shadow-2xl w-full max-w-sm text-center"><p className="text-gray-800 text-lg mb-6">{m}</p>{t==='confirm'?(<div className="flex justify-center gap-4"><button onClick={onC} className="py-2 px-6 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancelar</button><button onClick={oC} className="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">Confirmar</button></div>):(<button onClick={onC} className="py-2 px-6 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">Aceptar</button>)}</div></div>)}function C_Company({companyInfo:ci,setCompanyInfo:sCI}){const hC=e=>{const{name:n,value:v,type:t,checked:c}=e.target;sCI(p=>({...p,[n]:t==='checkbox'?c:v}))};const hLC=e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onloadend=()=>{sCI(p=>({...p,logo:r.result}))};r.readAsDataURL(f)}};return(<div className="p-6 bg-white rounded-lg shadow-md"><h2 className="text-2xl font-bold mb-4 text-gray-800">Datos de la Empresa</h2><form className="space-y-4"><div><label className="block text-sm font-medium text-gray-700">Nombre de la Empresa</label><input type="text" name="name" value={ci.name} onChange={hC} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /></div><div><label className="block text-sm font-medium text-gray-700">Dirección</label><input type="text" name="address" value={ci.address} onChange={hC} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /></div><div><label className="block text-sm font-medium text-gray-700">Teléfono</label><input type="text" name="phone" value={ci.phone} onChange={hC} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /></div><div><label className="block text-sm font-medium text-gray-700">Correo Electrónico</label><input type="email" name="email" value={ci.email} onChange={hC} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /></div><div><label className="block text-sm font-medium text-gray-700">CIF/NIF</label><input type="text" name="taxId" value={ci.taxId} onChange={hC} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /></div><div className="border-t pt-4"><label className="block text-sm font-medium text-gray-700">Logo de la Empresa</label><div className="mt-1 flex items-center space-x-4">{ci.logo&&<img src={ci.logo} alt="Logo de la empresa" className="h-16 w-16 rounded-md object-contain bg-gray-100 p-1" />}<input type="file" accept="image/*" onChange={hLC} className="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/></div></div><div className="border-t pt-4"><label className="block text-sm font-medium text-gray-700">Datos Bancarios</label><div className="mt-2"><label htmlFor="paymentMethod" className="block text-sm font-medium text-gray-700">Texto Forma de Pago</label><input type="text" id="paymentMethod" name="paymentMethod" value={ci.paymentMethod} onChange={hC} placeholder="Ej: Transferencia bancaria" className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /></div><div className="mt-2"><label htmlFor="iban" className="block text-sm font-medium text-gray-700">Nº IBAN</label><input type="text" id="iban" name="iban" value={ci.iban} onChange={hC} disabled={!ci.ibanEnabled} placeholder="ES00 0000 0000 0000 0000 0000" className="mt-1 w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm disabled:bg-gray-100" /></div><div className="mt-2 flex items-center"><input id="ibanEnabled" name="ibanEnabled" type="checkbox" checked={ci.ibanEnabled} onChange={hC} className="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" /><label htmlFor="ibanEnabled" className="ml-2 block text-sm text-gray-900">Mostrar en documentos</label></div></div><div className="border-t pt-4"><label className="block text-sm font-medium text-gray-700">Configuración de Impuestos</label><div className="mt-2 flex items-center gap-4"><div className="flex items-center"><input id="recargoEnabled" name="recargoEnabled" type="checkbox" checked={ci.recargoEnabled} onChange={hC} className="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" /><label htmlFor="recargoEnabled" className="ml-2 block text-sm text-gray-900">Activar Recargo de Equivalencia</label></div><div className="flex items-center"><input type="number" name="recargoPercentage" value={ci.recargoPercentage} onChange={hC} disabled={!ci.recargoEnabled} step="0.1" className="w-24 px-2 py-1 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm disabled:bg-gray-100" /><span className="ml-2 text-sm text-gray-500">%</span></div></div></div></form></div>)}function C_Articles({articles:arts,setArticles:sA,setNotification:sN}){const iAS={id:'',nombreProducto:'',codigoArticulo:'',numeroSerie:'',ean:'',precio:'',unidades:'',imagen:''};const[nA,sNA]=uS(iAS);const[eA,sEA]=uS(null);const[cA,sCA]=uS(null);const hC=e=>{const{name:n,value:v}=e.target;sNA(p=>({...p,[n]:v}))};const hIC=(e,aS)=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onloadend=()=>{aS(p=>({...p,imagen:r.result}))};r.readAsDataURL(f)}};const hS=e=>{e.preventDefault();if(!nA.nombreProducto||!nA.precio||!nA.unidades){sN({message:'Nombre, Precio y Unidades son campos obligatorios.'});return}sA(p=>[...p,{...nA,id:Date.now().toString()}]);sNA(iAS);sN({message:'Artículo añadido correctamente.'})};const hD=id=>{sCA({message:'¿Estás seguro de que quieres eliminar este artículo?',action:()=>{sA(p=>p.filter(a=>a.id!==id));sN({message:'Artículo eliminado.'});sCA(null)}})};const hUA=uA=>{sA(p=>p.map(a=>a.id===uA.id?uA:a));sEA(null);sN({message:'Artículo actualizado.'})};return(<div><C_Notify type="confirm" message={cA?.message} onConfirm={cA?.action} onCancel={()=>sCA(null)} />{eA&&(<C_Modal onClose={()=>sEA(null)} title="Editar Artículo"><C_EditArticleForm article={eA} onSave={hUA} onCancel={()=>sEA(null)} onImageChange={(e)=>hIC(e,sEA)} /></C_Modal>)}<div className="p-6 bg-white rounded-lg shadow-md mb-6"><h2 className="text-2xl font-bold mb-4 text-gray-800">Añadir Nuevo Artículo</h2><form onSubmit={hS} className="grid grid-cols-1 md:grid-cols-2 gap-4"><input type="text" name="nombreProducto" value={nA.nombreProducto} onChange={hC} placeholder="Nombre de producto *" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="codigoArticulo" value={nA.codigoArticulo} onChange={hC} placeholder="Código de artículo" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="numeroSerie" value={nA.numeroSerie} onChange={hC} placeholder="Número de serie" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="ean" value={nA.ean} onChange={hC} placeholder="EAN" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="number" name="precio" value={nA.precio} onChange={hC} placeholder="Precio *" step="0.01" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="number" name="unidades" value={nA.unidades} onChange={hC} placeholder="Unidades en stock *" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><div className="md:col-span-2"><label className="block text-sm font-medium text-gray-700">Imagen del Artículo</label><input type="file" accept="image/*" onChange={(e)=>hIC(e,sNA)} className="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/></div><div className="md:col-span-2"><button type="submit" className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">{I.add} Añadir Artículo</button></div></form></div><div className="bg-white rounded-lg shadow-md overflow-x-auto"><h2 className="text-2xl font-bold p-6 text-gray-800">Lista de Artículos</h2><table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Imagen</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Código</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th></tr></thead><tbody className="bg-white divide-y divide-gray-200">{arts.map(a=>(<tr key={a.id}><td className="px-6 py-4 whitespace-nowrap"><img src={a.imagen||'https://placehold.co/40x40/e2e8f0/e2e8f0?text=...'} alt={a.nombreProducto} className="w-10 h-10 rounded-md object-cover" /></td><td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{a.nombreProducto}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{a.codigoArticulo}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{parseFloat(a.precio).toFixed(2)} €</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{a.unidades}</td><td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"><button onClick={()=>sEA(a)} className="text-indigo-600 hover:text-indigo-900 p-1">{I.edit}</button><button onClick={()=>hD(a.id)} className="text-red-600 hover:text-red-900 p-1">{I.trash}</button></td></tr>))}</tbody></table>{arts.length===0&&<p className="text-center text-gray-500 py-8">No hay artículos. ¡Añade uno para empezar!</p>}</div></div>)}function C_EditArticleForm({article:a,onSave:oS,onCancel:oC,onImageChange:oIC}){const[fD,sFD]=uS(a);const hC=e=>{const{name:n,value:v}=e.target;sFD(p=>({...p,[n]:v}))};const hS=e=>{e.preventDefault();oS(fD)};return(<form onSubmit={hS} className="space-y-4"><input type="text" name="nombreProducto" value={fD.nombreProducto} onChange={hC} placeholder="Nombre de producto *" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="codigoArticulo" value={fD.codigoArticulo} onChange={hC} placeholder="Código de artículo" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="number" name="precio" value={fD.precio} onChange={hC} placeholder="Precio *" step="0.01" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="number" name="unidades" value={fD.unidades} onChange={hC} placeholder="Unidades en stock *" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><div><label className="block text-sm font-medium text-gray-700">Imagen del Artículo</label><input type="file" accept="image/*" onChange={(e)=>oIC(e)} className="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/></div><div className="flex justify-end gap-4"><button type="button" onClick={oC} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancelar</button><button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">Guardar Cambios</button></div></form>)}function C_Customers({customers:cs,setCustomers:sC,setNotification:sN}){const iCS={id:'',nombreApellidos:'',direccion:'',telefono:'',email:'',tipo:'Particular',dni:'',observaciones:''};const[nC,sNC]=uS(iCS);const[eC,sEC]=uS(null);const[sT,sST]=uS('');const[cA,sCA]=uS(null);const fC=uM(()=>{if(!sT){return cs}return cs.filter(c=>c.nombreApellidos.toLowerCase().includes(sT.toLowerCase())||(c.dni&&c.dni.toLowerCase().includes(sT.toLowerCase())))},[cs,sT]);const hC=e=>{const{name:n,value:v}=e.target;sNC(p=>({...p,[n]:v}))};const hS=e=>{e.preventDefault();if(!nC.nombreApellidos){sN({message:'El nombre es un campo obligatorio.'});return}sC(p=>[...p,{...nC,id:Date.now().toString()}]);sNC(iCS);sN({message:'Cliente añadido correctamente.'})};const hD=id=>{sCA({message:'¿Estás seguro de que quieres eliminar este cliente?',action:()=>{sC(p=>p.filter(c=>c.id!==id));sN({message:'Cliente eliminado.'});sCA(null)}})};const hUC=uC=>{sC(p=>p.map(c=>c.id===uC.id?uC:c));sEC(null);sN({message:'Cliente actualizado.'})};return(<div><C_Notify type="confirm" message={cA?.message} onConfirm={cA?.action} onCancel={()=>sCA(null)} />{eC&&(<C_Modal onClose={()=>sEC(null)} title="Editar Cliente"><C_EditCustomerForm customer={eC} onSave={hUC} onCancel={()=>sEC(null)} /></C_Modal>)}<div className="p-6 bg-white rounded-lg shadow-md mb-6"><h2 className="text-2xl font-bold mb-4 text-gray-800">Añadir Nuevo Cliente</h2><form onSubmit={hS} className="space-y-4"><input type="text" name="nombreApellidos" value={nC.nombreApellidos} onChange={hC} placeholder="Nombre y Apellidos *" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="dni" value={nC.dni} onChange={hC} placeholder="DNI / NIF" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="direccion" value={nC.direccion} onChange={hC} placeholder="Dirección" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="telefono" value={nC.telefono} onChange={hC} placeholder="Teléfono" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="email" name="email" value={nC.email} onChange={hC} placeholder="Correo Electrónico" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><textarea name="observaciones" value={nC.observaciones} onChange={hC} placeholder="Observaciones" rows="3" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea><select name="tipo" value={nC.tipo} onChange={hC} className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"><option>Particular</option><option>Empresa</option></select><button type="submit" className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">{I.add} Añadir Cliente</button></form></div><div className="bg-white rounded-lg shadow-md overflow-x-auto"><div className="p-6"><h2 className="text-2xl font-bold text-gray-800">Lista de Clientes</h2><div className="mt-4"><input type="text" placeholder="Buscar cliente por nombre o DNI..." value={sT} onChange={e=>sST(e.target.value)} className="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /></div></div><table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombre</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">DNI/NIF</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Contacto</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tipo</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th></tr></thead><tbody className="bg-white divide-y divide-gray-200">{fC.map(c=>(<tr key={c.id}><td className="px-6 py-4 whitespace-nowrap"><div className="text-sm font-medium text-gray-900">{c.nombreApellidos}</div>{c.observaciones&&<div className="text-xs text-gray-500 mt-1" title={c.observaciones}>Obs: {c.observaciones.substring(0,30)}{c.observaciones.length>30?'...':''}</div>}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{c.dni}</td><td className="px-6 py-4 whitespace-nowrap"><div className="text-sm text-gray-900">{c.telefono}</div><div className="text-sm text-gray-500">{c.email}</div></td><td className="px-6 py-4 whitespace-nowrap"><span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${c.tipo==='Empresa'?'bg-blue-100 text-blue-800':'bg-green-100 text-green-800'}`}>{c.tipo}</span></td><td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"><button onClick={()=>sEC(c)} className="text-indigo-600 hover:text-indigo-900 p-1">{I.edit}</button><button onClick={()=>hD(c.id)} className="text-red-600 hover:text-red-900 p-1">{I.trash}</button></td></tr>))}</tbody></table>{fC.length===0&&<p className="text-center text-gray-500 py-8">No hay clientes que coincidan con la búsqueda.</p>}</div></div>)}function C_EditCustomerForm({customer:c,onSave:oS,onCancel:oC}){const[fD,sFD]=uS(c);const hC=e=>{const{name:n,value:v}=e.target;sFD(p=>({...p,[n]:v}))};const hS=e=>{e.preventDefault();oS(fD)};return(<form onSubmit={hS} className="space-y-4"><input type="text" name="nombreApellidos" value={fD.nombreApellidos} onChange={hC} placeholder="Nombre y Apellidos *" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="dni" value={fD.dni} onChange={hC} placeholder="DNI / NIF" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="direccion" value={fD.direccion} onChange={hC} placeholder="Dirección" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="text" name="telefono" value={fD.telefono} onChange={hC} placeholder="Teléfono" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><input type="email" name="email" value={fD.email} onChange={hC} placeholder="Correo Electrónico" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /><textarea name="observaciones" value={fD.observaciones} onChange={hC} placeholder="Observaciones" rows="3" className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea><select name="tipo" value={fD.tipo} onChange={hC} className="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"><option>Particular</option><option>Empresa</option></select><div className="flex justify-end gap-4"><button type="button" onClick={oC} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancelar</button><button type="submit" className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700">Guardar Cambios</button></div></form>)}const C_PrintView=React.forwardRef(({doc:d,customer:c,companyInfo:ci,type:t},ref)=>{const dT=t==='invoice'?(d.isTicket?'FACTURA SIMPLIFICADA':'FACTURA'):'PRESUPUESTO';const dN=t==='invoice'?d.invoiceNumber:d.quoteNumber;return(<div ref={ref} className="p-8 bg-white" style={{width:'210mm',minHeight:'297mm'}}><div className="print-area"><header className="flex justify-between items-start pb-6 border-b-2 border-gray-200"><div><h2 className="text-3xl font-bold text-indigo-600">{dT}</h2><p className="text-sm text-gray-600">Nº: {dN}</p><p className="text-sm text-gray-600">Fecha: {new Date(d.date).toLocaleDateString('es-ES')}</p></div><div className="text-right">{ci.logo&&<img src={ci.logo} alt="Logo" className="h-20 w-auto max-w-xs object-contain ml-auto mb-2" />}<h1 className="text-xl font-bold text-gray-800">{ci.name||'Tu Empresa'}</h1><p className="text-sm text-gray-600">{ci.address}</p><p className="text-sm text-gray-600">{ci.phone}</p><p className="text-sm text-gray-600">{ci.email}</p><p className="text-sm text-gray-600">CIF/NIF: {ci.taxId}</p></div></header><section className="flex justify-between mt-8">{!d.isTicket&&(<div><h3 className="font-bold text-gray-700">Facturar a:</h3><p className="text-sm text-gray-600">{c?.nombreApellidos}</p><p className="text-sm text-gray-600">DNI/NIF: {c?.dni}</p><p className="text-sm text-gray-600">{c?.direccion}</p><p className="text-sm text-gray-600">{c?.telefono}</p><p className="text-sm text-gray-600">{c?.email}</p></div>)}</section><section className="mt-8"><table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Artículo</th><th className="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase">Cant.</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Precio Unit.</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total</th></tr></thead><tbody className="bg-white divide-y divide-gray-200">{d.items.map(i=>(<tr key={i.id}><td className="px-6 py-4 text-sm text-gray-800">{i.nombreProducto}</td><td className="px-6 py-4 text-center text-sm text-gray-600">{i.quantity}</td><td className="px-6 py-4 text-right text-sm text-gray-600">{parseFloat(i.precio).toFixed(2)} €</td><td className="px-6 py-4 text-right text-sm text-gray-600">{(i.precio*i.quantity).toFixed(2)} €</td></tr>))}</tbody></table></section><section className="flex justify-between items-end mt-16 pt-4 border-t-2 border-gray-200"><div>{ci.ibanEnabled&&ci.iban&&(<div><h3 className="font-bold text-gray-700 mb-1">Forma de pago</h3><p className="text-sm text-gray-600">{ci.paymentMethod||'Transferencia bancaria'}</p><p className="text-sm text-gray-600">IBAN: {ci.iban}</p></div>)}</div><div className="w-full md:w-1/3"><div className="flex justify-between text-sm text-gray-600"><span>Subtotal:</span><span>{d.subtotal.toFixed(2)} €</span></div><div className="flex justify-between text-sm text-gray-600"><span>IVA (21%):</span><span>{d.vat.toFixed(2)} €</span></div>{d.recargoAmount>0&&(<div className="flex justify-between text-sm text-gray-600"><span>R.E. ({d.recargoPercentage}%):</span><span>{d.recargoAmount.toFixed(2)} €</span></div>)}<div className="flex justify-between font-bold text-lg text-gray-800 mt-2 pt-2 border-t border-gray-200"><span>TOTAL:</span><span>{d.total.toFixed(2)} €</span></div></div></section></div></div>)});function C_Invoices({invoices:invs,setInvoices:sI,customers:cs,articles:arts,setArticles:sA,companyInfo:ci,setNotification:sN}){const iIS={id:'',invoiceNumber:'',customerId:'',date:new Date().toISOString().slice(0,10),items:[],subtotal:0,vat:0,recargoAmount:0,recargoPercentage:0,total:0,isTicket:!1};const[fS,sFS]=uS(iIS);const[iFO,sIFO]=uS(!1);const[eI,sEI]=uS(null);const[vI,sVI]=uS(null);const[fY,sFY]=uS('todos');const[fM,sFM]=uS('todos');const[aST,sAST]=uS('');const[sAId,sSAId]=uS('');const[cA,sCA]=uS(null);const pR=uR();const fAFS=uM(()=>{if(!aST){return[]}return arts.filter(a=>a.nombreProducto.toLowerCase().includes(aST.toLowerCase()))},[arts,aST]);const hOCF=()=>{const nIN=(invs.length+1).toString().padStart(4,'0');const y=new Date().getFullYear();sEI(null);sFS({...iIS,invoiceNumber:`${y}-${nIN}`});sIFO(!0)};const hOEF=i=>{sEI(i);sFS(i);sIFO(!0)};const hCF=()=>{sIFO(!1);sEI(null);sFS(iIS)};const hAI=sId=>{if(!sId)return;const aTA=arts.find(a=>a.id===sId);if(aTA){const eI=fS.items.find(i=>i.id===sId);let uI;if(eI){uI=fS.items.map(i=>i.id===sId?{...i,quantity:i.quantity+1}:i)}else{uI=[...fS.items,{...aTA,quantity:1}]}sFS(p=>({...p,items:uI}))}sSAId('');sAST('')};const uIQ=(aId,q)=>{const nQ=Math.max(1,q);const uI=fS.items.map(i=>i.id===aId?{...i,quantity:nQ}:i);sFS(p=>({...p,items:uI}))};const uIP=(aId,p)=>{const nP=isNaN(p)?0:p;const uI=fS.items.map(i=>i.id===aId?{...i,precio:nP}:i);sFS(p=>({...p,items:uI}))};const rIFI=aId=>{const uI=fS.items.filter(i=>i.id!==aId);sFS(p=>({...p,items:uI}))};uE(()=>{const s=fS.items.reduce((sum,i)=>sum+i.precio*i.quantity,0);const v=s*0.21;let rA=0;let rP=0;if(ci.recargoEnabled){rP=parseFloat(ci.recargoPercentage)||0;rA=s*(rP/100)}const t=s+v+rA;sFS(p=>({...p,subtotal:s,vat:v,recargoAmount:rA,recargoPercentage:rP,total:t}))},[fS.items,ci.recargoEnabled,ci.recargoPercentage]);const hS=()=>{if(!fS.customerId&&!fS.isTicket){sN({message:'Por favor, selecciona un cliente o marca la opción de Ticket.'});return}if(fS.items.length===0){sN({message:'Por favor, añade al menos un artículo a la factura.'});return}if(eI){const tA=JSON.parse(JSON.stringify(arts));eI.items.forEach(oI=>{const aI=tA.findIndex(a=>a.id===oI.id);if(aI!==-1){tA[aI].unidades=parseInt(tA[aI].unidades)+oI.quantity}});for(const nI of fS.items){const aI=tA.findIndex(a=>a.id===nI.id);if(aI===-1){sN({message:`Error: El artículo ${nI.nombreProducto} no existe.`});return}if(parseInt(tA[aI].unidades)<nI.quantity){sN({message:`No hay stock suficiente para "${nI.nombreProducto}".\nStock disponible (después de devolver el original): ${tA[aI].unidades}\nCantidad solicitada: ${nI.quantity}`});return}tA[aI].unidades=parseInt(tA[aI].unidades)-nI.quantity}sA(tA);sI(pI=>pI.map(i=>i.id===eI.id?fS:i));sN({message:'¡Factura modificada y stock actualizado!'})}else{for(const i of fS.items){const aIS=arts.find(a=>a.id===i.id);if(parseInt(aIS.unidades)<i.quantity){sN({message:`No hay stock suficiente para "${i.nombreProducto}".\nStock disponible: ${aIS.unidades}\nCantidad solicitada: ${i.quantity}`});return}}const uA=arts.map(a=>{const iII=fS.items.find(i=>i.id===a.id);if(iII){return{...a,unidades:parseInt(a.unidades)-iII.quantity}}return a});sA(uA);sI(p=>[...p,{...fS,id:Date.now().toString()}]);sN({message:'¡Factura creada y stock actualizado!'})}hCF()};const hDI=id=>{sCA({message:'¿Estás seguro de que quieres eliminar esta factura? La eliminación de una factura NO restaura el stock.',action:()=>{sI(p=>p.filter(i=>i.id!==id));sN({message:'Factura eliminada.'});sCA(null)}})};const hP=()=>{const{jsPDF}=window.jspdf;const pE=pR.current;window.html2canvas(pE,{scale:2}).then(c=>{const iD=c.toDataURL('image/png');const pdf=new jsPDF('p','mm','a4');const pW=pdf.internal.pageSize.getWidth();const pH=pdf.internal.pageSize.getHeight();const cW=c.width;const cH=c.height;const r=cW/cH;const iW=pW;const iH=iW/r;pdf.addImage(iD,'PNG',0,0,iW,iH);pdf.save(`factura-${vI.invoiceNumber}.pdf`)})};const fI=uM(()=>{return invs.filter(i=>{const iD=new Date(i.date);const yM=fY==='todos'||iD.getFullYear()===parseInt(fY);const mM=fM==='todos'||(iD.getMonth()+1)===parseInt(fM);return yM&&mM})},[invs,fY,fM]);const aY=uM(()=>{const y=new Set(invs.map(i=>new Date(i.date).getFullYear()));return Array.from(y).sort((a,b)=>b-a)},[invs]);if(vI){const c=cs.find(c=>c.id===vI.customerId);return(<div><button onClick={()=>sVI(null)} className="mb-4 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-600 hover:bg-gray-700">&larr; Volver a Facturas</button><C_PrintView ref={pR} doc={vI} customer={c} companyInfo={ci} type="invoice" /><button onClick={hP} className="mt-4 w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700">{I.print} Imprimir / Guardar como PDF</button></div>)}if(iFO){return(<div className="p-6 bg-white rounded-lg shadow-md"><h2 className="text-2xl font-bold mb-4 text-gray-800">{eI?'Modificar Factura':'Crear Nueva Factura'}</h2><div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label className="block text-sm font-medium text-gray-700">Nº Factura</label><input type="text" value={fS.invoiceNumber} disabled className="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md shadow-sm sm:text-sm" /></div><div><label className="block text-sm font-medium text-gray-700">Fecha</label><input type="date" value={fS.date} onChange={e=>sFS({...fS,date:e.target.value})} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /></div><div className="md:col-span-2 grid grid-cols-2 gap-4 items-center"><div><label className="block text-sm font-medium text-gray-700">Cliente</label><select value={fS.customerId} onChange={e=>sFS({...fS,customerId:e.target.value})} disabled={fS.isTicket} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"><option value="">Selecciona un cliente</option>{cs.map(c=><option key={c.id} value={c.id}>{c.nombreApellidos}</option>)}</select></div><div className="flex items-center pt-6"><input id="isTicketInvoice" name="isTicket" type="checkbox" checked={fS.isTicket} onChange={e=>sFS({...fS,isTicket:e.target.checked,customerId:e.target.checked?'':fS.customerId})} className="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" /><label htmlFor="isTicketInvoice" className="ml-2 block text-sm text-gray-900">Ticket (Venta sin cliente)</label></div></div></div><div className="border-t border-gray-200 pt-4 mt-4"><h3 className="text-lg font-semibold mb-2">Añadir Artículos</h3><div className="space-y-2"><div className="relative"><input type="text" placeholder="Buscar artículo por nombre..." value={aST} onChange={e=>sAST(e.target.value)} className="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />{aST&&fAFS.length>0&&(<ul className="absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto shadow-lg">{fAFS.map(a=>(<li key={a.id} onClick={()=>hAI(a.id)} className="px-4 py-2 hover:bg-indigo-100 cursor-pointer">{a.nombreProducto} (Stock: {a.unidades})</li>))}</ul>)}</div><select value={sAId} onChange={e=>hAI(e.target.value)} className="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"><option value="">O selecciona un artículo de la lista</option>{arts.map(a=>(<option key={a.id} value={a.id} disabled={a.unidades<1}>{a.nombreProducto} (Stock: {a.unidades})</option>))}</select></div></div><div className="mt-6"><h3 className="text-lg font-semibold mb-2">Artículos en la Factura</h3>{fS.items.map(i=>(<div key={i.id} className="flex items-center justify-between gap-2 p-2 mb-2 bg-gray-50 rounded-md flex-wrap"><span className="flex-grow min-w-0 break-words">{i.nombreProducto}</span><div className="flex items-center gap-2"><label className="text-sm">Precio:</label><input type="number" step="0.01" value={i.precio} onChange={(e)=>uIP(i.id,parseFloat(e.target.value))} className="w-24 text-right px-2 py-1 border border-gray-300 rounded-md" /></div><div className="flex items-center gap-2"><label className="text-sm">Cant:</label><input type="number" value={i.quantity} onChange={(e)=>uIQ(i.id,parseInt(e.target.value,10))} className="w-16 text-center px-2 py-1 border border-gray-300 rounded-md" /></div><span className="w-24 text-right font-semibold">{(i.precio*i.quantity).toFixed(2)} €</span><button onClick={()=>rIFI(i.id)} className="text-red-500 hover:text-red-700">{I.trash}</button></div>))}</div><div className="mt-6 border-t border-gray-200 pt-4 flex justify-end"><div className="w-full md:w-1/3 space-y-2"><div className="flex justify-between"><span>Subtotal:</span> <span>{fS.subtotal.toFixed(2)} €</span></div><div className="flex justify-between"><span>IVA (21%):</span> <span>{fS.vat.toFixed(2)} €</span></div>{fS.recargoAmount>0&&(<div className="flex justify-between"><span>R.E. ({fS.recargoPercentage}%):</span> <span>{fS.recargoAmount.toFixed(2)} €</span></div>)}<div className="flex justify-between font-bold text-xl"><span>Total:</span> <span>{fS.total.toFixed(2)} €</span></div></div></div><div className="mt-6 flex justify-end gap-4"><button onClick={hCF} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancelar</button><button onClick={hS} className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700">Guardar</button></div></div>)}return(<div><C_Notify type="confirm" message={cA?.message} onConfirm={cA?.action} onCancel={()=>sCA(null)} /><button onClick={hOCF} className="w-full mb-6 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">{I.add} Crear Nueva Factura</button><div className="p-4 bg-white rounded-lg shadow-md mb-6 flex items-center gap-4"><div className="flex-1"><label htmlFor="filter-year" className="block text-sm font-medium text-gray-700">Filtrar por Año</label><select id="filter-year" value={fY} onChange={e=>sFY(e.target.value)} className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"><option value="todos">Todos los Años</option>{aY.map(y=><option key={y} value={y}>{y}</option>)}</select></div><div className="flex-1"><label htmlFor="filter-month" className="block text-sm font-medium text-gray-700">Filtrar por Mes</label><select id="filter-month" value={fM} onChange={e=>sFM(e.target.value)} className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"><option value="todos">Todos los Meses</option>{[...Array(12).keys()].map(m=><option key={m+1} value={m+1}>{new Date(0,m).toLocaleString('es-ES',{month:'long'})}</option>)}</select></div></div><div className="bg-white rounded-lg shadow-md overflow-x-auto"><h2 className="text-2xl font-bold p-6 text-gray-800">Historial de Facturas</h2><table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nº Factura</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Acciones</th></tr></thead><tbody className="bg-white divide-y divide-gray-200">{fI.map(i=>{const c=cs.find(c=>c.id===i.customerId);return(<tr key={i.id}><td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{i.invoiceNumber}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{i.isTicket?<span className="font-semibold">FACTURA SIMPLIFICADA</span>:(c?.nombreApellidos||'Cliente no encontrado')}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{new Date(i.date).toLocaleDateString('es-ES')}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{i.total.toFixed(2)} €</td><td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"><button onClick={()=>sVI(i)} className="text-blue-600 hover:text-blue-900 p-1" title="Ver Factura">Ver</button><button onClick={()=>hOEF(i)} className="text-indigo-600 hover:text-indigo-900 p-1" title="Modificar Factura">{I.edit}</button><button onClick={()=>hDI(i.id)} className="text-red-600 hover:text-red-900 p-1" title="Eliminar Factura">{I.trash}</button></td></tr>)})}</tbody></table>{fI.length===0&&<p className="text-center text-gray-500 py-8">No hay facturas que coincidan con el filtro.</p>}</div></div>)}function C_Quotes({quotes:qs,setQuotes:sQ,invoices:invs,setInvoices:sI,customers:cs,articles:arts,setArticles:sA,companyInfo:ci,setNotification:sN}){const iQS={id:'',quoteNumber:'',customerId:'',date:new Date().toISOString().slice(0,10),items:[],subtotal:0,vat:0,recargoAmount:0,recargoPercentage:0,total:0,status:'pending',isTicket:!1};const[fS,sFS]=uS(iQS);const[iFO,sIFO]=uS(!1);const[eQ,sEQ]=uS(null);const[vQ,sVQ]=uS(null);const[aST,sAST]=uS('');const[sAId,sSAId]=uS('');const[cA,sCA]=uS(null);const pR=uR();const fAFS=uM(()=>{if(!aST){return[]}return arts.filter(a=>a.nombreProducto.toLowerCase().includes(aST.toLowerCase()))},[arts,aST]);const hOCF=()=>{const nQN=(qs.length+1).toString().padStart(4,'0');const y=new Date().getFullYear();sEQ(null);sFS({...iQS,quoteNumber:`PRE-${y}-${nQN}`});sIFO(!0)};const hOEF=q=>{sEQ(q);sFS(q);sIFO(!0)};const hCF=()=>{sIFO(!1);sEQ(null);sFS(iQS)};const hAI=sId=>{if(!sId)return;const aTA=arts.find(a=>a.id===sId);if(aTA){const eI=fS.items.find(i=>i.id===sId);let uI;if(eI){uI=fS.items.map(i=>i.id===sId?{...i,quantity:i.quantity+1}:i)}else{uI=[...fS.items,{...aTA,quantity:1}]}sFS(p=>({...p,items:uI}))}sSAId('');sAST('')};const uIQ=(aId,q)=>{const nQ=Math.max(1,q);sFS(p=>({...p,items:p.items.map(i=>i.id===aId?{...i,quantity:nQ}:i)}))};const uIP=(aId,p)=>{const nP=isNaN(p)?0:p;sFS(p=>({...p,items:p.items.map(i=>i.id===aId?{...i,precio:nP}:i)}))};const rIFQ=aId=>{sFS(p=>({...p,items:p.items.filter(i=>i.id!==aId)}))};uE(()=>{const s=fS.items.reduce((sum,i)=>sum+i.precio*i.quantity,0);const v=s*0.21;let rA=0;let rP=0;if(ci.recargoEnabled){rP=parseFloat(ci.recargoPercentage)||0;rA=s*(rP/100)}const t=s+v+rA;sFS(p=>({...p,subtotal:s,vat:v,recargoAmount:rA,recargoPercentage:rP,total:t}))},[fS.items,ci.recargoEnabled,ci.recargoPercentage]);const hS=()=>{if(!fS.customerId&&!fS.isTicket){sN({message:'Por favor, selecciona un cliente o marca la opción de Ticket.'});return}if(fS.items.length===0){sN({message:'Por favor, añade al menos un artículo.'});return}if(eQ){sQ(p=>p.map(q=>q.id===eQ.id?fS:q));sN({message:'¡Presupuesto modificado!'})}else{sQ(p=>[...p,{...fS,id:Date.now().toString()}]);sN({message:'¡Presupuesto creado!'})}hCF()};const hDQ=id=>{sCA({message:'¿Estás seguro de que quieres eliminar este presupuesto?',action:()=>{sQ(p=>p.filter(q=>q.id!==id));sN({message:'Presupuesto eliminado.'});sCA(null)}})};const hCTI=qTC=>{sCA({message:'¿Deseas generar una factura del presupuesto?',action:()=>{for(const i of qTC.items){const aIS=arts.find(a=>a.id===i.id);if(parseInt(aIS.unidades)<i.quantity){sN({message:`No hay stock suficiente para "${i.nombreProducto}" para crear la factura.\nStock disponible: ${aIS.unidades}\nCantidad solicitada: ${i.quantity}`});sCA(null);return}}const uA=arts.map(a=>{const iII=qTC.items.find(i=>i.id===a.id);if(iII){return{...a,unidades:parseInt(a.unidades)-iII.quantity}}return a});const nIN=(invs.length+1).toString().padStart(4,'0');const y=new Date().getFullYear();const nI={...qTC,id:Date.now().toString(),invoiceNumber:`${y}-${nIN}`};sA(uA);sI(p=>[...p,nI]);sQ(p=>p.map(q=>q.id===qTC.id?{...q,status:'converted'}:q));sN({message:`¡Presupuesto convertido a la factura Nº ${nI.invoiceNumber}!`});sCA(null)}})};const hP=()=>{const{jsPDF}=window.jspdf;const pE=pR.current;window.html2canvas(pE,{scale:2}).then(c=>{const iD=c.toDataURL('image/png');const pdf=new jsPDF('p','mm','a4');const pW=pdf.internal.pageSize.getWidth();const cW=c.width;const cH=c.height;const r=cW/cH;const iW=pW;const iH=iW/r;pdf.addImage(iD,'PNG',0,0,iW,iH);pdf.save(`presupuesto-${vQ.quoteNumber}.pdf`)})};if(vQ){const c=cs.find(c=>c.id===vQ.customerId);return(<div><button onClick={()=>sVQ(null)} className="mb-4 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-600 hover:bg-gray-700">&larr; Volver a Presupuestos</button><C_PrintView ref={pR} doc={vQ} customer={c} companyInfo={ci} type="quote" /><button onClick={hP} className="mt-4 w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700">{I.print} Imprimir / Guardar como PDF</button></div>)}if(iFO){return(<div className="p-6 bg-white rounded-lg shadow-md"><h2 className="text-2xl font-bold mb-4 text-gray-800">{eQ?'Modificar Presupuesto':'Crear Nuevo Presupuesto'}</h2><div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"><div><label className="block text-sm font-medium text-gray-700">Nº Presupuesto</label><input type="text" value={fS.quoteNumber} disabled className="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md shadow-sm sm:text-sm" /></div><div><label className="block text-sm font-medium text-gray-700">Fecha</label><input type="date" value={fS.date} onChange={e=>sFS({...fS,date:e.target.value})} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" /></div><div className="md:col-span-2 grid grid-cols-2 gap-4 items-center"><div><label className="block text-sm font-medium text-gray-700">Cliente</label><select value={fS.customerId} onChange={e=>sFS({...fS,customerId:e.target.value})} disabled={fS.isTicket} className="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm disabled:bg-gray-100 disabled:cursor-not-allowed"><option value="">Selecciona un cliente</option>{cs.map(c=><option key={c.id} value={c.id}>{c.nombreApellidos}</option>)}</select></div><div className="flex items-center pt-6"><input id="isTicket" name="isTicket" type="checkbox" checked={fS.isTicket} onChange={e=>sFS({...fS,isTicket:e.target.checked,customerId:e.target.checked?'':fS.customerId})} className="h-4 w-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" /><label htmlFor="isTicket" className="ml-2 block text-sm text-gray-900">Ticket (Venta sin cliente)</label></div></div></div><div className="border-t border-gray-200 pt-4 mt-4"><h3 className="text-lg font-semibold mb-2">Añadir Artículos</h3><div className="space-y-2"><div className="relative"><input type="text" placeholder="Buscar artículo por nombre..." value={aST} onChange={e=>sAST(e.target.value)} className="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" />{aST&&fAFS.length>0&&(<ul className="absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto shadow-lg">{fAFS.map(a=>(<li key={a.id} onClick={()=>hAI(a.id)} className="px-4 py-2 hover:bg-indigo-100 cursor-pointer">{a.nombreProducto} (Stock: {a.unidades})</li>))}</ul>)}</div><select value={sAId} onChange={e=>hAI(e.target.value)} className="w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"><option value="">O selecciona un artículo de la lista</option>{arts.map(a=>(<option key={a.id} value={a.id}>{a.nombreProducto} (Stock: {a.unidades})</option>))}</select></div></div><div className="mt-6"><h3 className="text-lg font-semibold mb-2">Artículos en el Presupuesto</h3>{fS.items.map(i=>(<div key={i.id} className="flex items-center justify-between gap-2 p-2 mb-2 bg-gray-50 rounded-md flex-wrap"><span className="flex-grow min-w-0 break-words">{i.nombreProducto}</span><div className="flex items-center gap-2"><label className="text-sm">Precio:</label><input type="number" step="0.01" value={i.precio} onChange={(e)=>uIP(i.id,parseFloat(e.target.value))} className="w-24 text-right px-2 py-1 border border-gray-300 rounded-md" /></div><div className="flex items-center gap-2"><label className="text-sm">Cant:</label><input type="number" value={i.quantity} onChange={(e)=>uIQ(i.id,parseInt(e.target.value,10))} className="w-16 text-center px-2 py-1 border border-gray-300 rounded-md" /></div><span className="w-24 text-right font-semibold">{(i.precio*i.quantity).toFixed(2)} €</span><button onClick={()=>rIFQ(i.id)} className="text-red-500 hover:text-red-700">{I.trash}</button></div>))}</div><div className="mt-6 border-t border-gray-200 pt-4 flex justify-end"><div className="w-full md:w-1/3 space-y-2"><div className="flex justify-between"><span>Subtotal:</span> <span>{fS.subtotal.toFixed(2)} €</span></div><div className="flex justify-between"><span>IVA (21%):</span> <span>{fS.vat.toFixed(2)} €</span></div>{fS.recargoAmount>0&&(<div className="flex justify-between"><span>R.E. ({fS.recargoPercentage}%):</span> <span>{fS.recargoAmount.toFixed(2)} €</span></div>)}<div className="flex justify-between font-bold text-xl"><span>Total:</span> <span>{fS.total.toFixed(2)} €</span></div></div></div><div className="mt-6 flex justify-end gap-4"><button onClick={hCF} className="py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50">Cancelar</button><button onClick={hS} className="py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700">Guardar</button></div></div>)}return(<div><C_Notify type="confirm" message={cA?.message} onConfirm={cA?.action} onCancel={()=>sCA(null)} /><button onClick={hOCF} className="w-full mb-6 flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">{I.add} Crear Nuevo Presupuesto</button><div className="bg-white rounded-lg shadow-md overflow-x-auto"><h2 className="text-2xl font-bold p-6 text-gray-800">Historial de Presupuestos</h2><table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nº Presupuesto</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Estado</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Acciones</th></tr></thead><tbody className="bg-white divide-y divide-gray-200">{qs.map(q=>{const c=cs.find(c=>c.id===q.customerId);const iC=q.status==='converted';return(<tr key={q.id} className={iC?'bg-green-50':''}><td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{q.quoteNumber}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{q.isTicket?<span className="font-semibold">TICKET</span>:(c?.nombreApellidos||'Cliente no encontrado')}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{new Date(q.date).toLocaleDateString('es-ES')}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{q.total.toFixed(2)} €</td><td className="px-6 py-4 whitespace-nowrap"><span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${iC?'bg-green-200 text-green-800':'bg-yellow-100 text-yellow-800'}`}>{iC?'Convertido':'Pendiente'}</span></td><td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2"><button onClick={()=>sVQ(q)} className="text-blue-600 hover:text-blue-900 p-1" title="Ver Presupuesto">Ver</button><button onClick={()=>hCTI(q)} disabled={iC} className="text-green-600 hover:text-green-900 p-1 disabled:opacity-50 disabled:cursor-not-allowed" title="Convertir a Factura">{I.convert}</button><button onClick={()=>hOEF(q)} disabled={iC} className="text-indigo-600 hover:text-indigo-900 p-1 disabled:opacity-50 disabled:cursor-not-allowed" title="Modificar Presupuesto">{I.edit}</button><button onClick={()=>hDQ(q.id)} className="text-red-600 hover:text-red-900 p-1" title="Eliminar Presupuesto">{I.trash}</button></td></tr>)})}</tbody></table>{qs.length===0&&<p className="text-center text-gray-500 py-8">No hay presupuestos creados.</p>}</div></div>)}function C_Dashboard({articles:arts,customers:cs,invoices:invs,quotes:qs}){const tR=invs.reduce((s,i)=>s+i.total,0);const tQ=qs.filter(q=>q.status==='pending').reduce((s,q)=>s+q.total,0);return(<div className="p-6 bg-white rounded-lg shadow-md"><h2 className="text-2xl font-bold mb-6 text-gray-800">Panel de Control</h2><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"><div className="bg-blue-100 p-6 rounded-lg text-center"><h3 className="text-3xl font-bold text-blue-800">{invs.length}</h3><p className="text-blue-700">Facturas Creadas</p></div><div className="bg-green-100 p-6 rounded-lg text-center"><h3 className="text-3xl font-bold text-green-800">{tR.toFixed(2)} €</h3><p className="text-green-700">Ingresos Facturados</p></div><div className="bg-orange-100 p-6 rounded-lg text-center"><h3 className="text-3xl font-bold text-orange-800">{tQ.toFixed(2)} €</h3><p className="text-orange-700">Pendiente en Presupuestos</p></div><div className="bg-yellow-100 p-6 rounded-lg text-center"><h3 className="text-3xl font-bold text-yellow-800">{cs.length}</h3><p className="text-yellow-700">Clientes Registrados</p></div></div></div>)}function C_Accounting({invoices:invs,customers:cs,companyInfo:ci,setNotification:sN}){const[fY,sFY]=uS(new Date().getFullYear().toString());const[fM,sFM]=uS((new Date().getMonth()+1).toString());const[iL,sIL]=uS(!1);const aY=uM(()=>{const y=new Set(invs.map(i=>new Date(i.date).getFullYear()));return Array.from(y).sort((a,b)=>b-a)},[invs]);const fI=uM(()=>{return invs.filter(i=>{const iD=new Date(i.date);const yM=fY==='todos'||iD.getFullYear()===parseInt(fY);const mM=fM==='todos'||(iD.getMonth()+1)===parseInt(fM);return yM&&mM})},[invs,fY,fM]);const ts=uM(()=>{return fI.reduce((a,i)=>{a.subtotal+=i.subtotal;a.vat+=i.vat;a.recargo+=i.recargoAmount||0;a.total+=i.total;return a},{subtotal:0,vat:0,recargo:0,total:0})},[fI]);const hEPDF=async()=>{if(fI.length===0){sN({message:"No hay facturas para exportar en el período seleccionado."});return}sIL(!0);sN({message:`Generando PDF con ${fI.length} factura(s)...`});const{jsPDF}=window.jspdf;const pdf=new jsPDF('p','mm','a4');const ctn=document.getElementById('pdf-container');for(let i=0;i<fI.length;i++){const inv=fI[i];const cust=cs.find(c=>c.id===inv.customerId);const tR=ReactDOM.createRoot(ctn);await new Promise(r=>{tR.render(<C_PrintView doc={inv} customer={cust} companyInfo={ci} type="invoice" />);setTimeout(r,50)});const canv=await window.html2canvas(ctn.firstChild,{scale:2});const iD=canv.toDataURL('image/png');const pW=pdf.internal.pageSize.getWidth();const iW=canv.width;const iH=canv.height;const r=iW/iH;const fIW=pW;const fIH=fIW/r;if(i>0){pdf.addPage()}pdf.addImage(iD,'PNG',0,0,fIW,fIH);tR.unmount()}pdf.save(`facturas_${fY}_${fM}.pdf`);sIL(!1);sN({message:"PDF generado y descargado con éxito."})};return(<div className="space-y-6"><div className="p-6 bg-white rounded-lg shadow-md"><h2 className="text-2xl font-bold mb-4 text-gray-800">Gestión de Contabilidad</h2><div className="flex flex-col md:flex-row items-center gap-4"><div className="flex-1 w-full"><label htmlFor="filter-year-acc" className="block text-sm font-medium text-gray-700">Año</label><select id="filter-year-acc" value={fY} onChange={e=>sFY(e.target.value)} className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"><option value="todos">Todos los Años</option>{aY.map(y=><option key={y} value={y}>{y}</option>)}</select></div><div className="flex-1 w-full"><label htmlFor="filter-month-acc" className="block text-sm font-medium text-gray-700">Mes</label><select id="filter-month-acc" value={fM} onChange={e=>sFM(e.target.value)} className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"><option value="todos">Todos los Meses</option>{[...Array(12).keys()].map(m=><option key={m+1} value={m+1}>{new Date(0,m).toLocaleString('es-ES',{month:'long'})}</option>)}</select></div><div className="pt-6"><button onClick={hEPDF} disabled={iL||fI.length===0} className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:bg-gray-400 disabled:cursor-not-allowed">{iL?'Generando...':<>{I.pdf} Descargar Facturas PDF</>}</button></div></div></div><div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"><div className="bg-blue-50 p-4 rounded-lg text-center shadow"><p className="text-sm text-blue-700">Base Imponible</p><h3 className="text-2xl font-bold text-blue-800">{ts.subtotal.toFixed(2)} €</h3></div><div className="bg-orange-50 p-4 rounded-lg text-center shadow"><p className="text-sm text-orange-700">IVA (21%)</p><h3 className="text-2xl font-bold text-orange-800">{ts.vat.toFixed(2)} €</h3></div><div className="bg-yellow-50 p-4 rounded-lg text-center shadow"><p className="text-sm text-yellow-700">Recargo Equiv.</p><h3 className="text-2xl font-bold text-yellow-800">{ts.recargo.toFixed(2)} €</h3></div><div className="bg-green-50 p-4 rounded-lg text-center shadow"><p className="text-sm text-green-700">Total Facturado</p><h3 className="text-2xl font-bold text-green-800">{ts.total.toFixed(2)} €</h3></div></div><div className="bg-white rounded-lg shadow-md overflow-x-auto"><h3 className="text-xl font-bold p-6 text-gray-700">Desglose de Facturas</h3><table className="min-w-full divide-y divide-gray-200"><thead className="bg-gray-50"><tr><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Nº Factura</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th><th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Base</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">IVA</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">R.E.</th><th className="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase">Total</th></tr></thead><tbody className="bg-white divide-y divide-gray-200">{fI.map(i=>{const c=cs.find(c=>c.id===i.customerId);return(<tr key={i.id}><td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{i.invoiceNumber}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{i.isTicket?'Ticket':(c?.nombreApellidos||'N/A')}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{new Date(i.date).toLocaleDateString('es-ES')}</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">{i.subtotal.toFixed(2)} €</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">{i.vat.toFixed(2)} €</td><td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-right">{(i.recargoAmount||0).toFixed(2)} €</td><td className="px-6 py-4 whitespace-nowrap text-sm font-bold text-gray-700 text-right">{i.total.toFixed(2)} €</td></tr>)})}</tbody></table>{fI.length===0&&<p className="text-center text-gray-500 py-8">No hay facturas para el período seleccionado.</p>}</div></div>)}function App(){const[p,sP]=uS('dashboard');const[ci,sCI]=usePersistentState('acc-ci',{name:'',address:'',phone:'',email:'',taxId:'',logo:'',recargoEnabled:!1,recargoPercentage:5.2,ibanEnabled:!1,iban:'',paymentMethod:'Transferencia bancaria'});const[arts,sA]=usePersistentState('acc-a',[]);const[cs,sC]=usePersistentState('acc-c',[]);const[invs,sI]=usePersistentState('acc-i',[]);const[qs,sQ]=usePersistentState('acc-q',[]);const[n,sN]=uS(null);const[cA,sCA]=uS(null);uE(()=>{if(n){const t=setTimeout(()=>{sN(null)},4000);return()=>clearTimeout(t)}},[n]);const NL=({pageName:pN,icon:ic,children:c})=>(<button onClick={()=>sP(pN)} className={`flex items-center space-x-3 px-4 py-3 w-full text-left rounded-lg transition-colors duration-200 ${p===pN?'bg-indigo-800 text-white':'text-indigo-100 hover:bg-indigo-700'}`}>{ic}<span className="font-medium">{c}</span></button>);const rP=()=>{switch(p){case'dashboard':return<C_Dashboard articles={arts} customers={cs} invoices={invs} quotes={qs} />;case'company':return<C_Company companyInfo={ci} setCompanyInfo={sCI} />;case'articles':return<C_Articles articles={arts} setArticles={sA} setNotification={sN} />;case'customers':return<C_Customers customers={cs} setCustomers={sC} setNotification={sN} />;case'invoices':return<C_Invoices invoices={invs} setInvoices={sI} customers={cs} articles={arts} setArticles={sA} companyInfo={ci} setNotification={sN} />;case'quotes':return<C_Quotes quotes={qs} setQuotes={sQ} invoices={invs} setInvoices={sI} customers={cs} articles={arts} setArticles={sA} companyInfo={ci} setNotification={sN} />;case'accounting':return<C_Accounting invoices={invs} customers={cs} companyInfo={ci} setNotification={sN} />;default:return<C_Dashboard />}};return(<div className="min-h-screen font-sans"><C_Notify type="alert" message={n?.message} onCancel={()=>sN(null)} /><C_Notify type="confirm" message={cA?.message} onConfirm={cA?.action} onCancel={()=>sCA(null)} /><div className="flex flex-col md:flex-row"><aside className="w-full md:w-64 bg-indigo-600 text-white p-4 flex flex-col"><div className="text-center mb-8"><h1 className="text-2xl font-bold">ContaApp</h1><p className="text-sm text-indigo-200">Gestión Sencilla</p></div><nav className="flex-grow space-y-2"><NL pageName="dashboard" icon={I.dashboard}>Panel</NL><NL pageName="quotes" icon={I.quotes}>Presupuestos</NL><NL pageName="invoices" icon={I.invoices}>Facturas</NL><NL pageName="accounting" icon={I.accounting}>Contabilidad</NL><NL pageName="articles" icon={I.articles}>Artículos</NL><NL pageName="customers" icon={I.customers}>Clientes</NL><NL pageName="company" icon={I.company}>Mi Empresa</NL></nav></aside><main className="flex-1 p-4 md:p-8 overflow-y-auto" style={{maxHeight:'100vh'}}>{rP()}</main></div></div>)}const container=document.getElementById('root');const root=ReactDOM.createRoot(container);root.render(<App />);

    </script>

    <style>@keyframes fade-in{from{opacity:0}to{opacity:1}}.animate-fade-in{animation:fade-in .3s ease-out forwards}@keyframes slide-up{from{transform:translateY(20px);opacity:0}to{transform:translateY(0);opacity:1}}.animate-slide-up{animation:slide-up .4s ease-out forwards}</style>

</body>

</html>